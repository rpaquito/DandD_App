{% extends "base.html" %}

{% block title %}Personagens Pré-Criados{% endblock %}

{% block extra_css %}
<style>
    .character-card {
        transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    .character-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 30px rgba(220, 53, 69, 0.3);
    }
    .stat-block {
        display: grid;
        grid-template-columns: repeat(6, 1fr);
        gap: 5px;
        text-align: center;
    }
    .stat-item {
        background: #333;
        padding: 8px 5px;
        border-radius: 5px;
    }
    .stat-name {
        font-size: 0.7rem;
        color: #aaa;
        text-transform: uppercase;
    }
    .stat-value {
        font-size: 1.1rem;
        font-weight: bold;
    }
    .stat-mod {
        font-size: 0.8rem;
        color: #ffc107;
    }
    .character-portrait {
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    .character-portrait:hover {
        transform: scale(1.05);
        box-shadow: 0 6px 20px rgba(220, 53, 69, 0.5) !important;
    }

    @media print {
        .no-print { display: none !important; }
        body { background: white !important; color: black !important; }
        .character-card {
            page-break-inside: avoid;
            border: 2px solid #000 !important;
            background: white !important;
        }
        .stat-item { background: #eee !important; }
    }
</style>
{% endblock %}

{% block content %}
<div class="container py-4">
    <div class="no-print mb-4">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="{{ url_for('main.index') }}">Inicio</a></li>
                <li class="breadcrumb-item active">Jogadores</li>
            </ol>
        </nav>
        <h1><i class="bi bi-people me-2"></i>Gerir Jogadores</h1>
        <p class="text-muted">
            Cria personagens personalizados ou usa os pre-criados para comecar rapidamente
        </p>
        <div class="d-flex gap-2 flex-wrap mb-4">
            <a href="{{ url_for('builder.start') }}" class="btn btn-success btn-lg">
                <i class="bi bi-plus-circle me-1"></i>Criar Novo Personagem
            </a>
            <a href="{{ url_for('print.premade_sheets') }}" class="btn btn-outline-primary">
                <i class="bi bi-printer me-1"></i>Imprimir Pre-Criados
            </a>
            <a href="{{ url_for('print.character_sheets') }}" class="btn btn-outline-secondary">
                <i class="bi bi-file-earmark me-1"></i>Fichas em Branco
            </a>
        </div>
    </div>

    <!-- Meus Personagens -->
    {% if saved_characters %}
    <div class="mb-5 no-print">
        <h3 class="mb-3"><i class="bi bi-person-badge text-success me-2"></i>Meus Personagens</h3>
        <div class="row g-3">
            {% for char in saved_characters %}
            {% set char_data = char.get_character_data() %}
            <div class="col-md-6 col-lg-4">
                <div class="card bg-dark border-success h-100">
                    <div class="card-body">
                        <h5 class="card-title text-light">{{ char.nome }}</h5>
                        <p class="text-light opacity-75 small mb-2">
                            {{ char.raca }} {{ char.classe }} Nivel {{ char.nivel }}
                        </p>
                        <div class="d-flex gap-2 mb-2">
                            <span class="badge bg-danger">HP {{ char_data.get('hp_max', 10) }}</span>
                            <span class="badge bg-info">AC {{ char_data.get('ac', 10) }}</span>
                        </div>
                        <small class="text-light opacity-75 d-block">
                            Criado: {{ char.criado_em.strftime('%d/%m/%Y') if char.criado_em else 'N/A' }}
                        </small>
                    </div>
                    <div class="card-footer border-success bg-transparent">
                        <button class="btn btn-sm btn-success w-100" onclick="viewCharacterDetails({{ char.id }})">
                            <i class="bi bi-eye me-1"></i>Ver Detalhes
                        </button>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <!-- Personagens Pre-Criados -->
    <h3 class="mb-3"><i class="bi bi-collection text-danger me-2"></i>Personagens Pre-Criados</h3>
    <div class="row g-4">
        {% for char in characters %}
        <div class="col-lg-6">
            <div class="card bg-dark border-secondary character-card h-100">
                <!-- Cabeçalho -->
                <div class="card-header border-secondary">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h4 class="mb-0">{{ char.nome }}</h4>
                            <small class="text-muted">
                                {{ char.raca }} {{ char.classe }} Nível {{ char.nivel }}
                            </small>
                        </div>
                        <div class="text-end">
                            <span class="badge bg-danger fs-6">{{ char.classe }}</span>
                        </div>
                    </div>
                </div>

                <div class="card-body">
                    <!-- Retrato do Personagem -->
                    {% if char.portrait %}
                    <div class="text-center mb-3">
                        <img src="{{ url_for('static', filename=char.portrait.replace('/static/', '')) }}"
                             alt="{{ char.nome }}"
                             class="img-fluid rounded border border-secondary character-portrait"
                             style="max-width: 250px; height: auto; box-shadow: 0 4px 12px rgba(220, 53, 69, 0.3);">
                    </div>
                    {% endif %}

                    <!-- Descrição -->
                    <p class="fst-italic text-muted mb-3">{{ char.descricao }}</p>

                    <!-- Stats Principais -->
                    <div class="row mb-3">
                        <div class="col-4 text-center">
                            <div class="bg-danger bg-opacity-25 rounded p-2">
                                <small class="text-muted d-block">HP</small>
                                <span class="fs-4 fw-bold">{{ char.hp_max }}</span>
                            </div>
                        </div>
                        <div class="col-4 text-center">
                            <div class="bg-info bg-opacity-25 rounded p-2">
                                <small class="text-muted d-block">AC</small>
                                <span class="fs-4 fw-bold">{{ char.ac }}</span>
                            </div>
                        </div>
                        <div class="col-4 text-center">
                            <div class="bg-success bg-opacity-25 rounded p-2">
                                <small class="text-muted d-block">Velocidade</small>
                                <span class="fs-5 fw-bold">{{ char.velocidade }}</span>
                            </div>
                        </div>
                    </div>

                    <!-- Atributos -->
                    <div class="stat-block mb-3">
                        <div class="stat-item">
                            <div class="stat-name">FOR</div>
                            <div class="stat-value">{{ char.forca }}</div>
                            <div class="stat-mod">{{ '%+d'|format((char.forca - 10) // 2) }}</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-name">DES</div>
                            <div class="stat-value">{{ char.destreza }}</div>
                            <div class="stat-mod">{{ '%+d'|format((char.destreza - 10) // 2) }}</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-name">CON</div>
                            <div class="stat-value">{{ char.constituicao }}</div>
                            <div class="stat-mod">{{ '%+d'|format((char.constituicao - 10) // 2) }}</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-name">INT</div>
                            <div class="stat-value">{{ char.inteligencia }}</div>
                            <div class="stat-mod">{{ '%+d'|format((char.inteligencia - 10) // 2) }}</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-name">SAB</div>
                            <div class="stat-value">{{ char.sabedoria }}</div>
                            <div class="stat-mod">{{ '%+d'|format((char.sabedoria - 10) // 2) }}</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-name">CAR</div>
                            <div class="stat-value">{{ char.carisma }}</div>
                            <div class="stat-mod">{{ '%+d'|format((char.carisma - 10) // 2) }}</div>
                        </div>
                    </div>

                    <!-- Ataques -->
                    <h6 class="text-danger"><i class="bi bi-lightning me-1"></i>Ataques</h6>
                    <table class="table table-sm table-dark mb-3">
                        <thead>
                            <tr>
                                <th>Arma</th>
                                <th>Bónus</th>
                                <th>Dano</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for ataque in char.ataques %}
                            <tr>
                                <td>{{ ataque.nome }}</td>
                                <td class="text-success">{{ ataque.bonus }}</td>
                                <td>{{ ataque.dano }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>

                    <!-- Perícias e Salvaguardas -->
                    <div class="row mb-3">
                        <div class="col-6">
                            <h6 class="text-info"><i class="bi bi-shield me-1"></i>Salvaguardas</h6>
                            <small>{{ char.salvaguardas|join(', ') }}</small>
                        </div>
                        <div class="col-6">
                            <h6 class="text-warning"><i class="bi bi-star me-1"></i>Perícias</h6>
                            <small>{{ char.pericias|join(', ') }}</small>
                        </div>
                    </div>

                    <!-- Características -->
                    <h6 class="text-success"><i class="bi bi-magic me-1"></i>Características</h6>
                    <ul class="small mb-3">
                        {% for carac in char.caracteristicas %}
                        <li>{{ carac }}</li>
                        {% endfor %}
                    </ul>

                    <!-- Magias (se aplicável) -->
                    {% if char.magias_conhecidas %}
                    <h6 class="text-primary"><i class="bi bi-stars me-1"></i>Magias</h6>
                    <div class="small mb-3">
                        <p class="mb-1"><strong>Truques:</strong> {{ char.magias_conhecidas.truques|join(', ') }}</p>
                        {% if char.magias_conhecidas.nivel_1 %}
                        <p class="mb-1"><strong>Nível 1 ({{ char.espacos_magia.nivel_1 }} espaços):</strong> {{ char.magias_conhecidas.nivel_1|join(', ') }}</p>
                        {% endif %}
                    </div>
                    {% endif %}

                    <!-- Equipamento -->
                    <h6><i class="bi bi-backpack me-1"></i>Equipamento</h6>
                    <small class="text-muted">
                        {{ char.armadura }} | {{ char.armas|join(', ') }}
                        <br>{{ char.equipamento|join(', ') }}
                    </small>
                </div>

                <!-- Rodapé com ações rápidas -->
                <div class="card-footer border-secondary no-print">
                    <div class="d-flex gap-2 flex-wrap">
                        <a href="{{ url_for('print.premade_sheet', char_id=char.id) }}" class="btn btn-sm btn-outline-info">
                            <i class="bi bi-printer me-1"></i>Imprimir
                        </a>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- Dicas para escolher personagens -->
    <div class="card bg-dark border-warning mt-4 no-print">
        <div class="card-header border-warning">
            <h5 class="mb-0 text-warning"><i class="bi bi-lightbulb me-2"></i>Dicas para Formar o Grupo</h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <h6>Grupo Equilibrado (4 jogadores)</h6>
                    <ul>
                        <li><strong>Guerreiro ou Paladino</strong> - Tanque na linha da frente</li>
                        <li><strong>Clérigo</strong> - Cura essencial</li>
                        <li><strong>Mago</strong> - Dano em área e utilidade</li>
                        <li><strong>Ladino ou Ranger</strong> - Perícias e dano furtivo</li>
                    </ul>
                </div>
                <div class="col-md-6">
                    <h6>Grupos Menores</h6>
                    <ul>
                        <li><strong>2 jogadores:</strong> Paladino + Ladino (cura e perícias)</li>
                        <li><strong>3 jogadores:</strong> Guerreiro + Clérigo + Mago</li>
                    </ul>
                    <h6 class="mt-3">Papel de Cada Classe</h6>
                    <small class="text-muted">
                        <strong>Guerreiro:</strong> Dano consistente, resistente<br>
                        <strong>Mago:</strong> Controlo e dano em área<br>
                        <strong>Clérigo:</strong> Cura e suporte<br>
                        <strong>Ladino:</strong> Perícias e dano furtivo<br>
                        <strong>Ranger:</strong> Versatilidade e exploração<br>
                        <strong>Paladino:</strong> Tanque com alguma cura
                    </small>
                </div>
            </div>
        </div>
    </div>
</div>

{% block extra_js %}
<script>
// Note: Combat tracker requires an active session
// Use session-based quest viewing to add characters to combat

function viewCharacterDetails(charId) {
    // TODO: Implement character details modal or redirect to detail page
    alert('Detalhes do personagem #' + charId + ' - Funcionalidade em desenvolvimento');
}
</script>
{% endblock %}
{% endblock %}
